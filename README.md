
# Virtual Machine Management System

## Описание проекта

Этот проект представляет собой клиент-серверное приложение для управления виртуальными машинами (ВМ) с использованием асинхронных сокетов (asyncio) и консольного приложения. Система позволяет добавлять, обновлять, подключать, авторизовать и деавторизовать виртуальные машины, а также получать информацию о них и связанных с ними жестких дисках.

## Структура проекта

- `client/`
  - `client.py`: Клиентское приложение, которое создает и тестирует несколько виртуальных машин.
  - `Dockerfile`: Dockerfile для сборки образа клиента.
- `server/`
  - `server.py`: Серверное приложение, реализующее функциональность для управления виртуальными машинами.
  - `tests/`
    - `test_server.py`: Набор тестов для проверки функциональности сервера.
  - `Dockerfile`: Dockerfile для сборки образа сервера.
- `docker-compose.yml`: Конфигурация Docker Compose для запуска контейнеров базы данных, сервера и клиента.

## Установка и запуск

1. Установите Docker и Docker Compose, если они еще не установлены.
2. Клонируйте репозиторий и перейдите в директорию проекта.
3. Запустите контейнеры с помощью Docker Compose:
   ```bash
   docker-compose up
   ```

## Функциональность API

### POST /add_vm

Добавление новой виртуальной машины в базу данных.

#### Пример запроса

```bash
curl -X POST http://localhost:8080/add_vm -H "Content-Type: application/json" -d '{
  "vm_id": "vm-1",
  "ram": 2048,
  "cpu": 2,
  "disks": [{"disk_id": "disk-1", "size": 500}]
}'
```

#### Тело запроса

```json
{
  "vm_id": "vm-1",
  "ram": 2048,
  "cpu": 2,
  "disks": [{"disk_id": "disk-1", "size": 500}]
}
```

#### Пример ответа

```
ВМ добавлена
```

### POST /update_vm

Обновление данных авторизованной виртуальной машины.

#### Пример запроса

```bash
curl -X POST http://localhost:8080/update_vm -H "Content-Type: application/json" -d '{
  "vm_id": "vm-1",
  "ram": 4096,
  "cpu": 4,
  "disks": [{"disk_id": "disk-1", "size": 1000}]
}'
```

#### Тело запроса

```json
{
  "vm_id": "vm-1",
  "ram": 4096,
  "cpu": 4,
  "disks": [{"disk_id": "disk-1", "size": 1000}]
}
```

#### Пример ответа

```
ВМ обновлена
```

### POST /connect_vm

Подключение виртуальной машины.

#### Пример запроса

```bash
curl -X POST http://localhost:8080/connect_vm -H "Content-Type: application/json" -d '{
  "vm_id": "vm-1",
  "ram": 2048,
  "cpu": 2,
  "disks": [{"disk_id": "disk-1", "size": 500}]
}'
```

#### Тело запроса

```json
{
  "vm_id": "vm-1",
  "ram": 2048,
  "cpu": 2,
  "disks": [{"disk_id": "disk-1", "size": 500}]
}
```

#### Пример ответа

```
ВМ подключена
```

### POST /authorize_vm

Авторизация виртуальной машины.

#### Пример запроса

```bash
curl -X POST http://localhost:8080/authorize_vm -H "Content-Type: application/json" -d '{
  "vm_id": "vm-1"
}'
```

#### Тело запроса

```json
{
  "vm_id": "vm-1"
}
```

#### Пример ответа

```
ВМ авторизована
```

### POST /deauthorize_vm

Деавторизация виртуальной машины.

#### Пример запроса

```bash
curl -X POST http://localhost:8080/deauthorize_vm -H "Content-Type: application/json" -d '{
  "vm_id": "vm-1"
}'
```

#### Тело запроса

```json
{
  "vm_id": "vm-1"
}
```

#### Пример ответа

```
ВМ деавторизована
```

### GET /get_all_vms

Получение списка всех виртуальных машин.

#### Пример запроса

```bash
curl -X GET http://localhost:8080/get_all_vms
```

#### Пример ответа

```json
[
  {
    "id": 1,
    "vm_id": "vm-1",
    "ram": 2048,
    "cpu": 2,
    "disks": [{"id": 1, "disk_id": "disk-1", "size": 500, "vm_id": 1}]
  }
]
```

### GET /get_connected_vms

Получение списка подключенных виртуальных машин.

#### Пример запроса

```bash
curl -X GET http://localhost:8080/get_connected_vms
```

#### Пример ответа

```json
[
  {
    "vm_id": "vm-1",
    "ram": 2048,
    "cpu": 2,
    "disks": [{"id": 1, "disk_id": "disk-1", "size": 500, "vm_id": 1}]
  }
]
```

### GET /get_authorized_vms

Получение списка авторизованных виртуальных машин.

#### Пример запроса

```bash
curl -X GET http://localhost:8080/get_authorized_vms
```

#### Пример ответа

```json
[
  {
    "vm_id": "vm-1",
    "ram": 2048,
    "cpu": 2,
    "disks": [{"id": 1, "disk_id": "disk-1", "size": 500, "vm_id": 1}]
  }
]
```

### GET /get_all_disks

Получение списка всех жестких дисков.

#### Пример запроса

```bash
curl -X GET http://localhost:8080/get_all_disks
```

#### Пример ответа

```json
[
  {
    "id": 1,
    "disk_id": "disk-1",
    "size": 500,
    "vm_id": 1
  }
]
```

### GET /health

Проверка состояния сервера.

#### Пример запроса

```bash
curl -X GET http://localhost:8080/health
```

#### Пример ответа

```
OK
```

## Описание файлов

### client/client.py

Клиентское приложение, которое создает и тестирует несколько виртуальных машин, проверяя весь функционал сервера.

### server/server.py

Серверное приложение, реализующее функциональность для управления виртуальными машинами. Включает методы для добавления, обновления, подключения, авторизации и деавторизации виртуальных машин, а также методы для получения информации о виртуальных машинах и их жестких дисках.

### server/tests/test_server.py

Набор тестов для проверки функциональности сервера с использованием `pytest` и `pytest-aiohttp`. Включает тесты для каждого маршрута API.

### server/Dockerfile

Dockerfile для сборки образа сервера. Включает установку зависимостей, копирование серверного кода и тестов, настройку окружения и запуск тестов перед запуском сервера.

### client/Dockerfile

Dockerfile для сборки образа клиента. Включает установку зависимостей и копирование клиентского кода.

### docker-compose.yml

Конфигурация Docker Compose для запуска контейнеров базы данных, сервера и клиента. Включает настройки для проверки состояния контейнеров и зависимости между ними.